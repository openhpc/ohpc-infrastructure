- name: Configure ohpc-lenovo-sms
  hosts: ohpc_lenovo_sms
  gather_facts: true
  vars:
    cluster: lenovo
  handlers:
    - name: Include handlers
      ansible.builtin.import_tasks: ../common/handlers.yml

  tasks:
    - name: Include ohpc-common-sms.yml
      ansible.builtin.include_tasks: ohpc-common-sms.yml

    - name: Fix dnf.conf
      ansible.builtin.lineinfile:
        path: /etc/dnf/dnf.conf
        line: "{{ item }}"
      with_items:
        - user_agent="curl"
      when: (distro.startswith("rocky")) or (distro == "almalinux9") or (distro.startswith("openEuler"))

    - name: Replace mirror URL for openeuler
      ansible.builtin.replace:
        path: /etc/yum.repos.d/openEuler.repo
        regexp: 'repo.openeuler.org'
        replace: 'repo.huaweicloud.com/openeuler'
      when: distro == "openEuler_22.03"
